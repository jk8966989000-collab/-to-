<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Merry Christmas</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:linear-gradient(#07192f,#0e2a47);
}
canvas{display:block;}
</style>
</head>

<body>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize",resize);

/* 字型 */
let fontsReady=false;
document.fonts.ready.then(()=>fontsReady=true);

/* frame */
let frame=0;

/* 狀態 */
let stage=0;
let flash=0;
let timer=0;

/* 雪 */
const snow=Array.from({length:120},()=>({
  x:Math.random()*canvas.width,
  y:Math.random()*canvas.height,
  r:Math.random()*2+1,
  s:Math.random()*0.6+0.4
}));

/* 煙火 */
const fireworks=[];

/* 中文 */
const lines=[
  "九千：",
  "這是我和妳一起過的",
  "第一個聖誕節，",
  "希望我們的友誼",
  "長長久久，",
  "未來能給彼此更多",
  "有趣的驚喜♡",
  "",
  "to.羊羊（2025/12/25）"
];
let lineIndex=0;
let charIndex=0;

/* 點擊 */
canvas.onclick=()=>{
  if(stage===0){
    stage=1;
    flash=60;
    setTimeout(()=>stage=2,1200);
    setTimeout(()=>stage=3,2500);
    setTimeout(()=>stage=4,3500);
    setTimeout(()=>stage=5,4500);
    setTimeout(()=>stage=6,5500);
    return;
  }
  if(stage===6){
    stage=7;
  }
};

/* 禮物盒 */
function drawGift(){
  if(stage!==0) return;
  const s=Math.min(canvas.width,canvas.height)*0.5;
  const x=canvas.width/2-s/2;
  const y=canvas.height/2-s/2;
  ctx.fillStyle="#c62828";
  ctx.fillRect(x,y,s,s);
  ctx.fillStyle="#ffd54f";
  ctx.fillRect(x+s/2-20,y,40,s);
  ctx.fillRect(x,y+s/2-20,s,40);
}

/* 兔子 */
function drawBunny(){
  if(stage<2||stage>3) return;
  const x=canvas.width/2;
  const y=canvas.height/2+80;
  const r=Math.min(canvas.width,canvas.height)*0.22;
  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(x,y,r,0,Math.PI*2);
  ctx.fill();
}

/* 英文 */
function drawTitle(){
  if(stage<4||!fontsReady) return;
  ctx.font="96px 'Great Vibes'";
  ctx.textAlign="center";
  ctx.fillStyle="rgba(255,215,160,0.95)";
  ctx.shadowColor="rgba(255,215,160,0.8)";
  ctx.shadowBlur=15;
  ctx.fillText("Merry Christmas",canvas.width/2,140);
  ctx.shadowBlur=0;
}

/* 煙火（穩定版） */
function spawnFirework(){
  const x=Math.random()*canvas.width;
  const y=Math.random()*canvas.height*0.55;
  const colors=["#ffd700","#ff6ec7","#7afcff","#b388ff","#fff176"];
  for(let i=0;i<70;i++){
    fireworks.push({
      x,y,
      vx:Math.cos(i/70*Math.PI*2)*(2+Math.random()*2),
      vy:Math.sin(i/70*Math.PI*2)*(2+Math.random()*2),
      life:80,
      color:colors[Math.floor(Math.random()*colors.length)]
    });
  }
}
function drawFireworks(){
  if(stage>=5 && frame%45===0) spawnFirework();
  fireworks.forEach(f=>{
    f.x+=f.vx;
    f.y+=f.vy;
    f.life--;
    ctx.globalAlpha=f.life/80;
    ctx.fillStyle=f.color;
    ctx.beginPath();
    ctx.arc(f.x,f.y,3,0,Math.PI*2);
    ctx.fill();
    ctx.globalAlpha=1;
  });
}

/* 中文 */
function drawChinese(){
  if(stage!==7) return;
  ctx.font="64px serif";
  ctx.textAlign="center";
  ctx.fillStyle="rgba(255,215,150,0.95)";
  let y=canvas.height/2-200;

  for(let i=0;i<lineIndex;i++){
    ctx.fillText(lines[i],canvas.width/2,y);
    y+=72;
  }

  if(lineIndex<lines.length && frame%7===0){
    charIndex++;
    if(charIndex>lines[lineIndex].length){
      lineIndex++;
      charIndex=0;
    }
  }
  if(lineIndex<lines.length){
    ctx.fillText(lines[lineIndex].slice(0,charIndex),canvas.width/2,y);
  }
}

/* 雪 */
function drawSnow(){
  ctx.fillStyle="#fff";
  snow.forEach(s=>{
    s.y+=s.s;
    if(s.y>canvas.height) s.y=-10;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
}

/* 金光 */
function drawFlash(){
  if(flash<=0) return;
  flash--;
  const g=ctx.createRadialGradient(
    canvas.width/2,canvas.height/2,0,
    canvas.width/2,canvas.height/2,canvas.width
  );
  g.addColorStop(0,`rgba(255,230,160,${flash/60})`);
  g.addColorStop(1,"rgba(255,230,160,0)");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

/* 主迴圈 */
function loop(){
  frame++;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawSnow();
  drawGift();
  drawFlash();
  drawBunny();
  drawTitle();
  drawFireworks();
  drawChinese();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
