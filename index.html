<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Merry Christmas</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  background:radial-gradient(circle at top,#0b1d3a,#020611);
  overflow:hidden;
}
canvas{display:block;}
</style>
</head>

<body>
<canvas id="c"></canvas>

<script>
const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight;}
resize();addEventListener("resize",resize);

/* ===== 狀態 ===== */
let stage=0;
let stageTime=0;

/* ===== 雪 ===== */
const snow=Array.from({length:160},()=>({
  x:Math.random()*c.width,
  y:Math.random()*c.height,
  r:Math.random()*1.5+0.5,
  v:Math.random()*0.6+0.3
}));

/* ===== 禮物 ===== */
let giftAlpha=1;

/* ===== 金光 ===== */
let glow=[];

/* ===== 兔子 & 愛心 ===== */
let bunnyAlpha=0;
let hearts=[];

/* ===== 煙火 ===== */
let fireworks=[];

/* ===== 文字 ===== */
const textLines=[
"九千：",
"這是我和妳一起過的",
"第一個聖誕節，",
"希望我們的友誼",
"長長久久，",
"未來能給彼此更多",
"有趣的驚喜♡",
"",
"to. 羊羊（2025/12/25）"
];
let lineIndex=0,charIndex=0,typing=false;

/* ===== 點擊 ===== */
c.onclick=()=>{
  if(stage===0){stage=1;stageTime=performance.now();explode();}
  else if(stage===3){stage=4;typing=true;}
};

/* ===== 功能 ===== */
function explode(){
  glow=Array.from({length:200},()=>({
    x:c.width/2,y:c.height/2,
    vx:(Math.random()-0.5)*20,
    vy:(Math.random()-0.5)*20,
    life:50
  }));
}

function spawnHeart(){
  hearts.push({
    x:c.width/2+70,
    y:c.height/2-200,
    size:18,
    alpha:1,
    vy:0.6
  });
}

function spawnFirework(){
  const x=Math.random()*c.width;
  const y=Math.random()*c.height*0.6+50;
  fireworks.push({
    x,y,
    parts:Array.from({length:50},()=>({
      angle:Math.random()*Math.PI*2,
      speed:Math.random()*4+2,
      life:60,
      hue:Math.random()*360
    }))
  });
}

/* ===== 畫 ===== */
function drawSnow(){
  ctx.fillStyle="#fff";
  snow.forEach(s=>{
    s.y+=s.v;if(s.y>c.height)s.y=-5;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
}

function drawGift(){
  if(giftAlpha<=0)return;
  ctx.save();
  ctx.globalAlpha=giftAlpha;
  ctx.translate(c.width/2,c.height/2);
  ctx.fillStyle="#c62828";
  ctx.fillRect(-180,-140,360,280);
  ctx.fillStyle="#ffd54f";
  ctx.fillRect(-25,-140,50,280);
  ctx.fillRect(-180,-25,360,50);
  ctx.restore();
}

function drawGlow(){
  glow.forEach(p=>{
    ctx.fillStyle=`rgba(255,215,120,${p.life/50})`;
    ctx.beginPath();
    ctx.arc(p.x,p.y,6,0,Math.PI*2);
    ctx.fill();
    p.x+=p.vx;p.y+=p.vy;p.life--;
  });
  glow=glow.filter(p=>p.life>0);
}

function drawBunny(){
  ctx.save();
  ctx.globalAlpha=bunnyAlpha;
  const x=c.width/2,y=c.height/2+80;
  ctx.fillStyle="#fff";
  ctx.beginPath();ctx.arc(x,y,140,0,Math.PI*2);ctx.fill();
  ctx.beginPath();
  ctx.ellipse(x-60,y-200,40,100,0,0,Math.PI*2);
  ctx.ellipse(x+60,y-200,40,100,0,0,Math.PI*2);
  ctx.fill();
  ctx.restore();
}

function drawHearts(){
  hearts.forEach(h=>{
    ctx.fillStyle=`rgba(255,150,180,${h.alpha})`;
    ctx.beginPath();
    ctx.moveTo(h.x,h.y);
    ctx.arc(h.x-h.size/2,h.y,h.size/2,0,Math.PI);
    ctx.arc(h.x+h.size/2,h.y,h.size/2,0,Math.PI);
    ctx.lineTo(h.x,h.y+h.size);
    ctx.fill();
    h.y-=h.vy;
    h.alpha-=0.01;
  });
  hearts=hearts.filter(h=>h.alpha>0);
}

function drawFireworks(){
  fireworks.forEach(f=>{
    f.parts.forEach(p=>{
      const px=f.x+Math.cos(p.angle)*p.speed*(60-p.life)/10;
      const py=f.y+Math.sin(p.angle)*p.speed*(60-p.life)/10;
      ctx.fillStyle=`hsla(${p.hue},100%,70%,${p.life/60})`;
      ctx.beginPath();ctx.arc(px,py,3,0,Math.PI*2);ctx.fill();
      p.life--;
    });
  });
  fireworks=fireworks.filter(f=>f.parts.some(p=>p.life>0));
}

function drawTitle(){
  ctx.font="80px Great Vibes";
  ctx.fillStyle="#f7d27c";
  ctx.shadowColor="#ffd700";
  ctx.shadowBlur=25;
  ctx.textAlign="center";
  ctx.fillText("Merry Christmas",c.width/2,120);
  ctx.shadowBlur=0;
}

function drawText(){
  ctx.font="64px Great Vibes";
  ctx.fillStyle="#f7d27c";
  ctx.textAlign="center";
  let y=c.height/2-160;
  for(let i=0;i<textLines.length;i++){
    let txt="";
    if(i<lineIndex) txt=textLines[i];
    else if(i===lineIndex) txt=textLines[i].substring(0,charIndex);
    ctx.fillText(txt,c.width/2,y);
    y+=70;
  }
}

/* ===== 主循環 ===== */
function loop(){
  ctx.clearRect(0,0,c.width,c.height);
  drawSnow();

  const now=performance.now();

  if(stage===0) drawGift();

  if(stage===1){
    giftAlpha-=0.02;
    drawGift();drawGlow();
    if(now-stageTime>1200){stage=2;stageTime=now;}
  }

  if(stage===2){
    bunnyAlpha=Math.min(1,bunnyAlpha+0.02);
    drawBunny();
    if(Math.random()<0.05)spawnHeart();
    drawHearts();
    if(now-stageTime>2200){stage=3;bunnyAlpha=0;}
  }

  if(stage>=3){
    if(Math.random()<0.05)spawnFirework();
    drawFireworks();
    drawTitle();
  }

  if(stage===4 && typing){
    if(charIndex<textLines[lineIndex].length){
      charIndex++;
    }else{
      lineIndex++;
      charIndex=0;
      if(lineIndex>=textLines.length) typing=false;
    }
    drawText();
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
